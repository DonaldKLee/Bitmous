<!DOCTYPE>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!--Font Awesome-->
        <script src="https://kit.fontawesome.com/ba7447c34f.js" crossorigin="anonymous"></script>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <!-- Bootstrap ^^^ -->

        <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    </head>
    <body>
    
        {% for mess in get_flashed_messages()  %}
            <h1>{{ mess }}</h1>
        {% endfor %}


        <!-- Form -->
        <form class="form" action="/submit" method="post">
            <h1>Bitmous</h1>

            {{ form.csrf_token }}

            <label>Alias:</label><br>
            {{ form.post_alias(placeholder="Spy", label="Hi", type="name", id="alias_form", oninput="posting()") }}
            
            <i id="alias_check" class="post_check_mark fas fa-check"></i>
            <p id="alias_length">Characters: 0 | Min: 2 | Max: 15</p>

            {% for error in form.post_alias.errors %}
                <li class="errors">{{ error }}</li>
            {% endfor %}

            </br>
            <label>Content:</label><br>
            {{ form.post_content(placeholder="Stay humble y'all!",label="Hi", id="content_form", oninput="posting()") }}
            
            <i id="content_check" class="post_check_mark fas fa-check"></i>
            <p id="content_length">Characters: 0 | Min: 10 | Max: 150</p>
            
            <ul>
            {% for error in form.post_content.errors %}
                <li class="errors">{{ error }}</li>
            {% endfor %}
            </ul>
            
            <br>

            {{ form.colours(class="radio_colours") }}

            <br>
            <input id="submit_button" type="submit" value="Post" disabled/>
        </form> 
        <!-- Form ^^^ -->

        <section class="posts">
        {% for post in post_data.all_posts|reverse %}
            <a class="stickynote_button_link" href="#post{{ post.post_id }}"><button class="a_post" style="background:{{ post.colour }};" data-toggle="modal" data-target="#post{{ post.post_id }}">


                <h3>Alias: {{ post.code_name }}</h3>
                <p>{{ post.content }}</p>
                <p>Date Posted: {{ post.date_posted }}</p>
                <p>{{ post.comments|length }} comments</p>
            </button></a>

        {% endfor %}
        </section>

        {% for post in post_data.all_posts %}
            
            <!-- Modal -->
            
            <div class="modal fade" id="post{{ post.post_id }}" role="dialog">
                <div class="modal-dialog">
                
                <!-- Modal content-->
                <div class="modal-content" style="background:{{ post.colour }};">
                   
                        <button type="button" class="close" data-dismiss="modal">&times;</button>

                        <div class="modal_post_container">
                            <p class="modal_alias">Alias: {{ post.code_name }}</p>
                            <p class="modal_comment">{{ post.content }}</p>
                            <p class="modal_date">Date Posted: {{ post.date_posted }}</p>
                        </div>
                    
                    
                    <div class="all_comments">
                        {% if not post.comments  %}
                            <h4>Looks like this post has no comments yet!</h4>
                            <p>Why not be the first to comment?</p>
                        {% else %}

                            {% for comment in post.comments %}
                                <p class="modal_alias">Alias: {{ comment.code_name }}</p>
                                <p class="modal_comment">{{ comment.content }}</p>
                                <p class="modal_date">Date Posted: {{ comment.date_posted }}</p>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <form class="form" action="/comment" method="post">
                        {{ comment.csrf_token }}
                        <label>Alias:</label><br>
                        {{ comment.comment_alias(placeholder="Penguin", type="name") }}

                        {% for error in comment.comment_alias.errors %}
                            <li class="errors">{{ error }}</li>
                        {% endfor %}

                        </br>

                        <label>Content:</label><br>
                        {{ comment.comment_content(placeholder="You are awesome!") }}

                        <ul>
                        {% for error in comment.comment_content.errors %}
                            <li class="errors">{{ error }}</li>
                        {% endfor %}
                        </ul>

                    <input id="submit_button" type="submit" value="Post"/>
                    {{ comment.post_id(value=post.post_id, style='display:none;') }}
                    </form>


                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                </div>
            </div>
        
        {% endfor %}
    
    </body>


    <script> // Checks if the hash is empty, if it is, ignore, else, use the hash from the failed comment submission
        function jump(post_id){
            location.href = "#post" + post_id;  //Go to the target element. 
        }
        $(function(){
        if(window.location.hash.length === 0) {
            jump({{ anchor }});
            }
        });
    </script>

    <script type=text/javascript src="{{ url_for('static', filename='javascript/home.js') }}"></script>


</html>